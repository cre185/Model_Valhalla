var I=Object.defineProperty;var A=(d,e,t)=>e in d?I(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var h=(d,e,t)=>(A(d,typeof e!="symbol"?e+"":e,t),t);import{u as $,d as c,e as u}from"./index.d740cb91.js";import{g as y,b as L}from"./user-info.e23f06cc.js";const z=$();class k{constructor(e,t,f,a,s,o,l,m,n,i){h(this,"author");h(this,"toAuthor");h(this,"commentId",-1);h(this,"toId");h(this,"avatar");h(this,"content");h(this,"datetime");h(this,"like");h(this,"ifLike");h(this,"ifHate");h(this,"ifReply");h(this,"lastClicked");h(this,"children");this.author=e,this.toAuthor=t,this.avatar=f,this.content=a,this.datetime=s,this.like=o,this.ifLike=l,this.ifHate=m,this.ifReply=n,this.lastClicked=-2,this.children=i}async increaseLike(e,t,f,a){this.like+=1;const s=await c.post(u("/user/find_user_by_name"),{username:t},{headers:{Authorization:e}});z.accountId!==s.data.id&&await c.post(u("/user/create_message"),{msg_type:"Like",msg:"Unknown",target:[s.data.id],msg_content:{likeContent:this.content,likeFlag:a,targetID:f}},{headers:{Authorization:e}})}decreaseLike(){this.like-=1}async changeLikeState(e,t,f,a=!0){this.ifLike=!this.ifLike,this.ifLike?this.increaseLike(e,t,f,a):this.decreaseLike(),a?await c.post(u("/ranking/like_llm_comment"),{id:this.commentId},{headers:{Authorization:e}}):await c.post(u("/ranking/like_dataset_comment"),{id:this.commentId},{headers:{Authorization:e}}),this.ifHate&&(this.ifHate=!1)}async changeHateState(e,t=!0){this.ifHate=!this.ifHate,t?await c.post(u("/ranking/like_llm_comment"),{id:this.commentId,dislike:!0},{headers:{Authorization:e}}):await c.post(u("/ranking/like_dataset_comment"),{id:this.commentId,dislike:!0},{headers:{Authorization:e}}),this.ifLike&&(this.ifLike=!1,this.decreaseLike())}changeReplyState(e,t){this.lastClicked===-2?(this.ifReply=!0,this.lastClicked=t):this.ifReply?this.lastClicked===t?(this.ifReply=!1,this.lastClicked=-2):this.lastClicked!==t&&(this.lastClicked=t):(this.ifReply=!0,this.lastClicked=t),e.content=""}async addComment(e,t,f,a,s=!0){this.ifReply=!1;const o=new k("","","","","",0,!1,!1,!1,[]),l=new Date,m=l.getFullYear(),n=(l.getMonth()+1).toString().padStart(2,"0"),i=l.getDate().toString().padStart(2,"0"),p=l.getHours().toString().padStart(2,"0"),g=l.getMinutes().toString().padStart(2,"0");o.datetime=`${m}-${n}-${i} ${p}:${g}`,t.toAuthor===""?o.content=`${t.content}`:o.content=`@ ${t.toAuthor} :${t.content}`,o.avatar=t.avatar,o.author=t.author,o.toAuthor=t.toAuthor,o.toId=t.toId,await S(f,o,a,s),e.children.push(o),t.content="",t.toId=void 0}}const b=k;async function x(d,e,t,f=!0){let a;f?a=await c.get(u(`/ranking/llm_comment/${d}`),{headers:{Authorization:t}}):a=await c.get(u(`/ranking/dataset_comment/${d}`),{headers:{Authorization:t}}),e.value=[];for(const s of a.data.data){const o=s.user;let l,m;if(await y(o).then(n=>{l=n}),await L(o).then(n=>{m=n}),s.respond_to===null){const n=new k(l,"",m,s.comment,s.add_time,s.like,s.if_like,s.if_dislike,!1,[]);n.commentId=s.id,e.value.push(n)}else{let n=s.respond_to;for(let r=0;r<a.data.data.length;r+=1)if(a.data.data[r].id===n){n=r;break}let i=a.data.data[n];const p=i.user;let g="";await y(p).then(r=>{g=r});const _=new k(l,g,m,s.comment,s.add_time,s.like,s.if_like,s.if_dislike,!1,[]);for(_.commentId=s.id,_.toId=i.commentId;i.respond_to!==null;){n=i.respond_to;for(let r=0;r<a.data.data.length;r+=1)if(a.data.data[r].id===n){n=r;break}i=a.data.data[n]}for(let r=0;r<e.value.length;r+=1)if(e.value[r].commentId===i.id){e.value[r].children.push(_);break}}}}async function S(d,e,t,f=!0){let a;if(f){const i=await c.post(u("/ranking/comment"),{llm:d,comment:e.content,respond_to:e.toId},{headers:{Authorization:t}});e.commentId=i.data.id,a=await c.get(u(`/ranking/llm_comment/${d}`),{headers:{Authorization:t}})}else{const i=await c.post(u("/ranking/comment"),{dataset:d,comment:e.content,respond_to:e.toId},{headers:{Authorization:t}});e.commentId=i.data.id,a=await c.get(u(`/ranking/dataset_comment/${d}`),{headers:{Authorization:t}})}let s,o,l,m,n;for(let i=a.data.data.length-1;i>=0;i--)if(a.data.data[i].id===e.commentId){n=a.data.data[i].user,s=a.data.data[i].respond_to,m=a.data.data[i].comment;break}if(s){for(let i=0;i<a.data.data.length;i++)if(a.data.data[i].id===s){o=a.data.data[i].user,l=a.data.data[i].comment;break}n!==o&&await c.post(u("/user/create_message"),{msg_type:"Reply",msg:"Unknown",target:[o],msg_content:{parentContent:l,childContent:m,contentFlag:f,targetID:d}},{headers:{Authorization:t}})}}export{b as M,x as g,S as u};
