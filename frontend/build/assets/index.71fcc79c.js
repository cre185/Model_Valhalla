import{d as E,r as L,j as N,a$ as X,C as x,D as W,G as l,aN as r,aI as o,aH as t,aM as d,u as M,aE as D,aF as j,aQ as Z,b5 as ee,b6 as oe,b7 as te,b8 as ae,b9 as se,aY as re,ba as ne,bb as le,bc as ie,bd as de,be as z,bf as O,g as me}from"./arco.a9e9ea8e.js";import{B as ce,_ as ue}from"./banner.bab2aea3.js";import{F as pe}from"./index.fed99cd4.js";import{v as ge,u as _e,g as fe,I as ve,a as he,b as be,c as we,_ as Q}from"./index.d740cb91.js";/* empty css              *//* empty css              *//* empty css               *//* empty css               *//* empty css               */import{f as ye,g as Ie}from"./vue.6f0b04ed.js";import{u as $e}from"./loading.992f9f87.js";import{g as ke,a as Pe,b as Ce,c as Se,d as Ve,e as Te}from"./user-info.e23f06cc.js";import"./chart.095b9a7e.js";const Me=m=>(z("data-v-5515b426"),m=m(),O(),m),xe={class:"login-form-wrapper"},Be={class:"login-form-title"},Fe={class:"login-form-error-msg"},Ue={class:"login-form-password-actions"},Ne={class:"login-form-error-msg"},Re=Me(()=>l("div",{id:"codeMargin"},null,-1)),qe=E({__name:"login-form",setup(m){const I=ye(),{t:R}=ge.exports.useI18n(),$=L(""),{loading:B,setLoading:F}=$e(),v=_e(),{proxy:k}=me(),_=Ie("login-by-password-config",{rememberPassword:!0,username:"admin",password:"admin"}),h=N({username:_.value.username,password:_.value.password}),f=N({mobile:"",code:""}),p=N({codeTimer:null,codeInterval:-1}),P=L("1"),q=async({errors:e,values:a})=>{if(!B.value&&!e){F(!0);try{P.value==="1"?await v.login(a):await v.loginByPhone(a);const{redirect:c,...b}=I.currentRoute.value.query,n=fe(),g=v.$state.accountId;let C,S,V,u,w,y;if(await ke(g,n).then(s=>{C=s}),await Pe(g,n).then(s=>{S=s}),await Ce(g,n).then(s=>{console.log(s),V=s}),await Se(g,n).then(s=>{u=s}),await Ve(g,n).then(s=>{w=s}),await Te(g,n).then(s=>{y=s}),v.setInfo({username:C,avatar:V,registrationDate:S,phone:u,email:w,role:y}),localStorage.setItem("userStore",JSON.stringify(v.$state)),I.push({name:c||"Index",query:{...b}}),Z.success(R("login.form.login.success")),P.value==="1"){const{rememberPassword:s}=_.value,{username:T,password:U}=a;_.value.username=s?T:"",_.value.password=s?U:""}}catch(c){$.value=c.message}finally{F(!1)}}},A=async()=>{try{p.codeInterval=60,p.codeTimer=setInterval(()=>{p.codeInterval>=0?p.codeInterval-=1:clearInterval(p.codeTimer)},1e3);const e=await v.verifyPhone(f.mobile)}catch(e){$.value=e.message}finally{F(!1)}},G=e=>{_.value.rememberPassword=e},H=[{validator:(e,a)=>new Promise(c=>{window.setTimeout(()=>{e===""?a(k.$t("login.form.phone.errMsg1")):/1[3,4578][0-9]{9}/.test(e)||a(k.$t("login.form.phone.errMsg2")),c()},1e3)})}],J=[{required:!0,validator:(e,a)=>new Promise(c=>{window.setTimeout(()=>{e=f.code,e===""?a(k.$t("register.form.code.errMsg1")):/\d{6}/.test(e)||a(k.$t("login.form.code.errMsg2")),c()},1e3)}),trigger:["change","blur"]}];return(e,a)=>{const c=ve,b=ee,n=oe,g=he,C=te,S=ae,V=se,u=re,w=X("router-link"),y=ne,s=le,T=ie,U=be,K=we,Y=de;return x(),W("div",xe,[l("div",Be,r(e.$t("login.form.title")),1),o(Y,{"active-key":P.value,"onUpdate:activeKey":a[5]||(a[5]=i=>P.value=i)},{default:t(()=>[o(T,{key:"1"},{title:t(()=>[d(r(e.$t("login.form.loginWay.password")),1)]),default:t(()=>[l("div",Fe,r($.value),1),o(s,{ref:"loginForm",model:h,class:"login-form",layout:"vertical",onSubmit:q},{default:t(()=>[o(n,{field:"username",rules:[{required:!0,message:e.$t("login.form.userName.errMsg")}],"validate-trigger":["change","blur"],"hide-label":""},{default:t(()=>[o(b,{modelValue:h.username,"onUpdate:modelValue":a[0]||(a[0]=i=>h.username=i),placeholder:e.$t("login.form.userName.placeholder")},{prefix:t(()=>[o(c)]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),o(n,{field:"password",rules:[{required:!0,message:e.$t("login.form.password.errMsg")}],"validate-trigger":["change","blur"],"hide-label":""},{default:t(()=>[o(C,{modelValue:h.password,"onUpdate:modelValue":a[1]||(a[1]=i=>h.password=i),placeholder:e.$t("login.form.password.placeholder"),"allow-clear":""},{prefix:t(()=>[o(g)]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),o(y,{size:16,direction:"vertical"},{default:t(()=>[l("div",Ue,[o(S,{checked:"rememberPassword","model-value":M(_).rememberPassword,onChange:G},{default:t(()=>[d(r(e.$t("login.form.rememberPassword")),1)]),_:1},8,["model-value","onChange"]),o(V,{onClick:a[2]||(a[2]=i=>M(I).push({name:"ChangeInfo",params:{toChange:"password",mobileReadOnly:0}}))},{default:t(()=>[d(r(e.$t("login.form.forgetPassword")),1)]),_:1})]),o(u,{type:"primary","html-type":"submit",long:"",loading:M(B)},{default:t(()=>[d(r(e.$t("login.form.login")),1)]),_:1},8,["loading"]),o(w,{to:"/register"},{default:t(()=>[o(u,{type:"text",long:"",class:"login-form-register-btn"},{default:t(()=>[d(r(e.$t("login.form.register")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(T,{key:"2"},{title:t(()=>[d(r(e.$t("login.form.loginWay.code")),1)]),default:t(()=>[l("div",Ne,r($.value),1),o(s,{ref:"loginForm",model:f,class:"login-form",layout:"vertical",onSubmit:q},{default:t(()=>[o(n,{field:"mobile",rules:H,"validate-trigger":["change","blur"],"hide-label":""},{default:t(()=>[o(b,{modelValue:f.mobile,"onUpdate:modelValue":a[3]||(a[3]=i=>f.mobile=i),placeholder:e.$t("login.form.phone.placeholder")},{prefix:t(()=>[o(U)]),_:1},8,["modelValue","placeholder"])]),_:1}),o(n,{field:"code",rules:J,"hide-label":""},{default:t(()=>[o(b,{modelValue:f.code,"onUpdate:modelValue":a[4]||(a[4]=i=>f.code=i),placeholder:e.$t("login.form.code.placeholder"),"allow-clear":""},{prefix:t(()=>[o(K)]),append:t(()=>[p.codeInterval<0?(x(),D(u,{key:0,type:"primary",onClick:A},{default:t(()=>[d(r(e.$t("login.form.code.buttonText1")),1)]),_:1})):j("",!0),p.codeInterval>=0?(x(),D(u,{key:1},{default:t(()=>[d(r(p.codeInterval+e.$t("register.form.code.buttonText2")),1)]),_:1})):j("",!0)]),_:1},8,["modelValue","placeholder"])]),_:1}),o(y,{size:16,direction:"vertical"},{default:t(()=>[Re,o(u,{type:"primary","html-type":"submit",long:"",loading:M(B)},{default:t(()=>[d(r(e.$t("login.form.login")),1)]),_:1},8,["loading"]),o(w,{to:"../register"},{default:t(()=>[o(u,{type:"text",long:"",class:"login-form-register-btn"},{default:t(()=>[d(r(e.$t("login.form.register")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["active-key"])])}}});const Le=Q(qe,[["__scopeId","data-v-5515b426"]]),De=m=>(z("data-v-ed7b1219"),m=m(),O(),m),je={class:"container"},Ee=De(()=>l("div",{class:"logo"},[l("img",{alt:"logo",src:ue}),l("div",{class:"logo-text"},"Model Valhalla")],-1)),We={class:"content"},ze={class:"content-inner"},Oe={class:"footer"},Qe=E({__name:"index",setup(m){return(I,R)=>(x(),W("div",je,[Ee,o(ce),l("div",We,[l("div",ze,[o(Le)]),l("div",Oe,[o(pe)])])]))}});const ro=Q(Qe,[["__scopeId","data-v-ed7b1219"]]);export{ro as default};
