var g=Object.defineProperty;var p=(s,t,e)=>t in s?g(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var l=(s,t,e)=>(p(s,typeof t!="symbol"?t+"":t,e),e);import{d,e as r}from"./index.d740cb91.js";async function w(s,t,e,n,c){fetch(r("/testing/stream_generate"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:s},body:JSON.stringify({llmId:n,prompt:t})}).then(a=>{const h=a.body.getReader();let i="";function o(){return h.read().then(({done:u,value:m})=>{if(u){c.scrollTop=c.scrollHeight;return}i+=new TextDecoder("utf-8").decode(m),e.setAnswer(i),c.scrollTop=c.scrollHeight,o()})}o()}).catch(a=>{console.error("Error fetching stream:",a)})}async function Q(){const s={data:[],total:0},t=await d.get(r("/testing/list"));for(let e=0;e<t.data.data.length;e+=1){const n=t.data.data[e];s.data.push({id:n.id.toString(),name:n.name})}return s}async function T(s){return d.post(r("/ranking/update"),s)}async function b(){const s={data:[],total:0},t=await d.get(r("/dataset/list"));for(let e=0;e<t.data.data.length;e+=1){const n=t.data.data[e];n.subjective&&s.data.push({id:n.id,name:n.name})}return s}async function v(s){return(await d.get(r(`/testing/retrieve/${s}`))).data.name}class L{constructor(t,e,n){l(this,"question");l(this,"answerA");l(this,"answerB");this.question=t,this.answerA=e,this.answerB=n}}class A{constructor(t){l(this,"modelA");l(this,"modelB");l(this,"QA");l(this,"result");this.modelA=t,this.modelB=-1,this.QA=[],this.result=0}async getModelB(){const t=await d.post(r("/testing/battle_match"),{llmId:this.modelA});if(this.modelB=t.data.llmId,Math.random()<.5){const e=this.modelA;this.modelA=this.modelB,this.modelB=e}}async getStreamResponse(t,e,n,c){fetch(r("/testing/stream_generate"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify({llmId:this.modelA,prompt:this.QA[this.QA.length-1].question})}).then(a=>{const h=a.body.getReader();function i(o){return h.read().then(({done:u,value:m})=>{if(u){e.scrollTop=e.scrollHeight;return}o.QA[o.QA.length-1].answerA+=new TextDecoder("utf-8").decode(m),e.scrollTop=e.scrollHeight,i(o)})}this.QA[this.QA.length-1].answerA="",i(this)}).catch(a=>{console.error("Error fetching stream:",a)}),fetch(r("/testing/stream_generate"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify({llmId:this.modelB,prompt:this.QA[this.QA.length-1].question})}).then(a=>{const h=a.body.getReader();function i(o){return h.read().then(({done:u,value:m})=>{if(u){n.scrollTop=n.scrollHeight,c.value=!1;return}o.QA[o.QA.length-1].answerB+=new TextDecoder("utf-8").decode(m),n.scrollTop=n.scrollHeight,i(o)})}this.QA[this.QA.length-1].answerB="",i(this)}).catch(a=>{console.error("Error fetching stream:",a)})}async updateEloResult(){await d.post(r("/testing/battle_result"),{llm1:this.modelA,llm2:this.modelB,result:this.QA,winner:this.result,round:this.QA.length})}async sendAdvise(t,e){d.post(r("/user/create_message_to_admin"),{msg:"Unknown",msg_type:"Advice",msg_content:{adviceContent:e}},{headers:{Authorization:t}})}}const S=A;export{S as E,L as Q,b as a,w as b,v as g,Q as q,T as u};
